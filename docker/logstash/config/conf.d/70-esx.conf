filter {

  if "Section for VMware ESX" in [message] {
    drop {
      add_tag => [ "dropped" ]
    }
  }
  if [type] == "syslog_esx" {
#    multiline {
#      pattern => "-->"
#      what => "previous"
#    }
    grok {
      break_on_match => true
      match => [
         "message", "<%{POSINT:syslog_pri}>%{TIMESTAMP_ISO8601:syslog_timestamp} %{SYSLOGHOST:syslog_hostname} %{SYSLOGPROG:syslog_program}\s?(INFO)?: %{GREEDYDATA:syslog_message}"
        ]
    }

    date {
      match => [ "syslog_timestamp", "MMM  d HH:mm:ss", "MMM dd HH:mm:ss", "YYYY-MM-ddHH:mm:ss,SSS", "YYYY-MM-dd HH:mm:ss,SSS", "ISO8601" ]
    }

#    if "NetPktHeapLow" in [syslog_message] {
#      grok {
#        match => [
#          "syslog_message", "\[%{WORD}\]: %{GREEDYDATA}: %{INT:free_max}, %{GREEDYDATA}: %{INT:free_cur}, %{GREEDYDATA}: %{INT:alloc_fail}"
#        ]
#      }
#      mutate {
#        add_tag => [ "HEAPER" ]
#      }
#    }

    if "_grokparsefailure" in [tags] {
      mutate {
        add_tag => [ "grok fail in 70-esx" ]
      }
    }
  }

}
